{"version":3,"sources":["webpack://MIDI/webpack/universalModuleDefinition","webpack://MIDI/webpack/bootstrap","webpack://MIDI/(webpack)/buildin/harmony-module.js","webpack://MIDI/./src/gm.js","webpack://MIDI/./src/index.js","webpack://MIDI/./src/jasmid/_stream.js","webpack://MIDI/./src/jasmid/index.js","webpack://MIDI/./src/jasmid/midifile.js","webpack://MIDI/./src/jasmid/replayer.js","webpack://MIDI/./src/loader.js","webpack://MIDI/./src/player.js","webpack://MIDI/./src/plugins/audiotag.js","webpack://MIDI/./src/plugins/index.js","webpack://MIDI/./src/plugins/webaudio.js","webpack://MIDI/./src/plugins/webmidi.js","webpack://MIDI/./src/root.js","webpack://MIDI/./src/utils/audio-detect.js","webpack://MIDI/./src/utils/index.js","webpack://MIDI/./src/utils/load-script.js","webpack://MIDI/./src/utils/request.js"],"names":["root","GM","map","clean","name","replace","toLowerCase","res","byName","byId","byCategory","key","list","n","length","instrument","num","parseInt","substr","indexOf","id","number","category","getInstrument","channelId","channel","channels","setInstrument","program","delay","setTimeout","getMono","mono","setMono","truthy","getOmni","omni","setOmni","getSolo","solo","setSolo","i","pitchBend","mute","keyToNote","noteToKey","A0","C8","number2key","octave","window","MIDI","module","exports","str","position","read","result","readInt32","charCodeAt","readInt16","readInt8","signed","eof","readVarInt","b","MidiFile","data","lastEventTypeByte","readChunk","stream","readEvent","event","deltaTime","eventTypeByte","type","subtypeByte","subtype","Error","text","microsecondsPerBeat","hourByte","frameRate","hour","min","sec","frame","subframe","numerator","denominator","Math","pow","metronome","thirtyseconds","scale","param1","eventType","noteNumber","velocity","amount","controllerType","value","programNumber","Stream","headerChunk","headerStream","formatType","trackCount","timeDivision","ticksPerBeat","header","tracks","trackChunk","trackStream","push","clone","o","ret","Replayer","midiFile","timeWarp","eventProcessor","bpm","trackStates","beatsPerMinute","bpmOverride","getNextEvent","ticksToNextEvent","nextEventTrack","nextEventIndex","nextEvent","midiEvent","temporal","processEvents","processNext","beatsToGenerate","secondsToGenerate","ticksToEvent","time","getData","Soundfont","DEBUG","USE_XHR","soundfontUrl","loadPlugin","opts","onsuccess","audioDetect","supports","hash","location","api","webmidi","AudioContext","Audio","connect","audioFormat","targetFormat","__api","__audioFormat","loadResource","instruments","format","WebMIDI","audiotag","requestQueue","webaudio","context","onprogress","onerror","pending","waitForEnd","instrumentId","sendRequest","evt","progress","fileProgress","queueProgress","soundfontPath","request","url","responseText","script","document","createElement","language","body","appendChild","loadScript","add","verify","setDefaultPlugin","midi","Player","player","currentTime","endTime","restart","playing","startDelay","BPM","start","resume","startAudio","pause","tmp","stopAudio","stop","addListener","onMidiEvent","removeListener","undefined","clearAnimation","animationFrameId","cancelAnimationFrame","setAnimation","callback","tOurTime","tTheirTime","requestAnimationFrame","Date","now","total","minutes","seconds","t1","t2","end","events","noteRegistrar","loadMidiFile","replayer","currentData","getLength","console","error","loadFile","file","atob","split","fetch","XMLHttpRequest","open","overrideMimeType","onreadystatechange","readyState","status","t","ff","mx","scc","String","fromCharCode","z","join","send","getFileInstruments","programs","gm","isFinite","eventQueue","queuedTime","startTime","scheduleTracking","note","offset","message","shift","getContext","WebAudio","ctx","totalTime","__now","getNow","performance","fromCache","messages","foffset","obj","queueTime","setController","programChange","MIDIOffset","source","noteOn","interval","noteOff","pop","clearInterval","clearTimeout","disconnect","AudioTag","volume","bufferNid","audioBuffers","notesOn","notes","nid","playChannel","instrumentNoteId","audio","log","src","play","stopChannel","len","cId","setVolume","chordOn","chord","idx","chordOff","stopAllNotes","base64ToArrayBuffer","base64","binaryString","bytes","Uint8Array","buffer","useStreamingBuffer","sources","effects","masterVolume","noteId","bufferId","createMediaElementSource","createBufferSource","chain","input","gain","destination","playbackRate","gainNode","createGain","max","linearRampToValueAtTime","sid","setEffects","tunajs","effect","setContext","createAudioContext","newCtx","onload","Tuna","urls","bufferPending","requestAudio","soundfont","index","loadAudio","isLoaded","err","synth","controls","autoplay","preload","addEventListener","decodeAudioData","responseType","response","webkitAudioContext","plugin","output","cancel","errFunction","navigator","requestMIDIAccess","then","access","pluginOutputs","outputs","canPlayThrough","mime","setAttribute","removeChild","isNative","Function","prototype","toString","call","plugins","canPlayType","vorbis","mpeg","getTime","setInterval","maxExecution","_globalExists","path","parts","object","e","LoadScript","loaded","loading","config","that","doc","getElementsByTagName","testElement","element","test","getNext","hasError","batchTest","addElement","removeTest","onLoad","istrue","strictOrder","ID","method","headers","withCredentials","xhr","setRequestHeader","upload","totalBytes","lengthComputable","rawBytes","getResponseHeader","target","responseXML","JSON","parse"],"mappings":"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","file":"midi.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"MIDI\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MIDI\"] = factory();\n\telse\n\t\troot[\"MIDI\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","module.exports = function(originalModule) {\n\tif (!originalModule.webpackPolyfill) {\n\t\tvar module = Object.create(originalModule);\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"exports\", {\n\t\t\tenumerable: true\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","/*\n  ----------------------------------------------------------\n  GeneralMIDI\n  ----------------------------------------------------------\n*/\n\nimport root from './root'\n\nroot.GM = (function (map) {\n  const clean = function (name) {\n    return name.replace(/[^a-z0-9 ]/gi, '').replace(/[ ]/g, '_').toLowerCase()\n  }\n  const res = {\n    byName: { },\n    byId: { },\n    byCategory: { }\n  }\n  for (let key in map) {\n    var list = map[key]\n    for (var n = 0, length = list.length; n < length; n++) {\n      var instrument = list[n]\n      if (!instrument) continue\n      var num = parseInt(instrument.substr(0, instrument.indexOf(' ')), 10)\n      instrument = instrument.replace(num + ' ', '')\n      res.byId[--num] =\n        res.byName[clean(instrument)] =\n          res.byCategory[clean(key)] = {\n            id: clean(instrument),\n            instrument: instrument,\n            number: num,\n            category: key\n          }\n    }\n  }\n  return res\n})({\n  'Piano': ['1 Acoustic Grand Piano', '2 Bright Acoustic Piano', '3 Electric Grand Piano', '4 Honky-tonk Piano', '5 Electric Piano 1', '6 Electric Piano 2', '7 Harpsichord', '8 Clavinet'],\n  'Chromatic Percussion': ['9 Celesta', '10 Glockenspiel', '11 Music Box', '12 Vibraphone', '13 Marimba', '14 Xylophone', '15 Tubular Bells', '16 Dulcimer'],\n  'Organ': ['17 Drawbar Organ', '18 Percussive Organ', '19 Rock Organ', '20 Church Organ', '21 Reed Organ', '22 Accordion', '23 Harmonica', '24 Tango Accordion'],\n  'Guitar': ['25 Acoustic Guitar (nylon)', '26 Acoustic Guitar (steel)', '27 Electric Guitar (jazz)', '28 Electric Guitar (clean)', '29 Electric Guitar (muted)', '30 Overdriven Guitar', '31 Distortion Guitar', '32 Guitar Harmonics'],\n  'Bass': ['33 Acoustic Bass', '34 Electric Bass (finger)', '35 Electric Bass (pick)', '36 Fretless Bass', '37 Slap Bass 1', '38 Slap Bass 2', '39 Synth Bass 1', '40 Synth Bass 2'],\n  'Strings': ['41 Violin', '42 Viola', '43 Cello', '44 Contrabass', '45 Tremolo Strings', '46 Pizzicato Strings', '47 Orchestral Harp', '48 Timpani'],\n  'Ensemble': ['49 String Ensemble 1', '50 String Ensemble 2', '51 Synth Strings 1', '52 Synth Strings 2', '53 Choir Aahs', '54 Voice Oohs', '55 Synth Choir', '56 Orchestra Hit'],\n  'Brass': ['57 Trumpet', '58 Trombone', '59 Tuba', '60 Muted Trumpet', '61 French Horn', '62 Brass Section', '63 Synth Brass 1', '64 Synth Brass 2'],\n  'Reed': ['65 Soprano Sax', '66 Alto Sax', '67 Tenor Sax', '68 Baritone Sax', '69 Oboe', '70 English Horn', '71 Bassoon', '72 Clarinet'],\n  'Pipe': ['73 Piccolo', '74 Flute', '75 Recorder', '76 Pan Flute', '77 Blown Bottle', '78 Shakuhachi', '79 Whistle', '80 Ocarina'],\n  'Synth Lead': ['81 Lead 1 (square)', '82 Lead 2 (sawtooth)', '83 Lead 3 (calliope)', '84 Lead 4 (chiff)', '85 Lead 5 (charang)', '86 Lead 6 (voice)', '87 Lead 7 (fifths)', '88 Lead 8 (bass + lead)'],\n  'Synth Pad': ['89 Pad 1 (new age)', '90 Pad 2 (warm)', '91 Pad 3 (polysynth)', '92 Pad 4 (choir)', '93 Pad 5 (bowed)', '94 Pad 6 (metallic)', '95 Pad 7 (halo)', '96 Pad 8 (sweep)'],\n  'Synth Effects': ['97 FX 1 (rain)', '98 FX 2 (soundtrack)', '99 FX 3 (crystal)', '100 FX 4 (atmosphere)', '101 FX 5 (brightness)', '102 FX 6 (goblins)', '103 FX 7 (echoes)', '104 FX 8 (sci-fi)'],\n  'Ethnic': ['105 Sitar', '106 Banjo', '107 Shamisen', '108 Koto', '109 Kalimba', '110 Bagpipe', '111 Fiddle', '112 Shanai'],\n  'Percussive': ['113 Tinkle Bell', '114 Agogo', '115 Steel Drums', '116 Woodblock', '117 Taiko Drum', '118 Melodic Tom', '119 Synth Drum'],\n  'Sound effects': ['120 Reverse Cymbal', '121 Guitar Fret Noise', '122 Breath Noise', '123 Seashore', '124 Bird Tweet', '125 Telephone Ring', '126 Helicopter', '127 Applause', '128 Gunshot']\n})\n\n/* get/setInstrument\n--------------------------------------------------- */\nroot.getInstrument = function (channelId) {\n  var channel = root.channels[channelId]\n  return channel && channel.instrument\n}\n\nroot.setInstrument = function (channelId, program, delay) {\n  var channel = root.channels[channelId]\n  if (delay) {\n    return setTimeout(function () {\n      channel.instrument = program\n    }, delay)\n  } else {\n    channel.instrument = program\n  }\n}\n\n/* get/setMono\n--------------------------------------------------- */\nroot.getMono = function (channelId) {\n  var channel = root.channels[channelId]\n  return channel && channel.mono\n}\n\nroot.setMono = function (channelId, truthy, delay) {\n  var channel = root.channels[channelId]\n  if (delay) {\n    return setTimeout(function () {\n      channel.mono = truthy\n    }, delay)\n  } else {\n    channel.mono = truthy\n  }\n}\n\n/* get/setOmni\n--------------------------------------------------- */\nroot.getOmni = function (channelId) {\n  var channel = root.channels[channelId]\n  return channel && channel.omni\n}\n\nroot.setOmni = function (channelId, truthy, delay) {\n  var channel = root.channels[channelId]\n  if (delay) {\n    return setTimeout(function () {\n      channel.omni = truthy\n    }, delay)\n  } else {\n    channel.omni = truthy\n  }\n}\n\n/* get/setSolo\n--------------------------------------------------- */\nroot.getSolo = function (channelId) {\n  var channel = root.channels[channelId]\n  return channel && channel.solo\n}\n\nroot.setSolo = function (channelId, truthy, delay) {\n  var channel = root.channels[channelId]\n  if (delay) {\n    return setTimeout(function () {\n      channel.solo = truthy\n    }, delay)\n  } else {\n    channel.solo = truthy\n  }\n}\n\n/* channels\n--------------------------------------------------- */\nroot.channels = (function () { // 0 - 15 channels\n  var channels = {}\n  for (let i = 0; i < 16; i++) {\n    channels[i] = { // default values\n      instrument: i,\n      pitchBend: 0,\n      mute: false,\n      mono: false,\n      omni: false,\n      solo: false\n    }\n  }\n  return channels\n})()\n\n/* note conversions\n--------------------------------------------------- */\nroot.keyToNote = {} // C8  == 108\nroot.noteToKey = {} // 108 ==  C8\n\n~(function () {\n  var A0 = 0x15 // first note\n  var C8 = 0x6C // last note\n  var number2key = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B']\n  for (let n = A0; n <= C8; n++) {\n    var octave = (n - 12) / 12 >> 0\n    var name = number2key[n % 12] + octave\n    root.keyToNote[name] = n\n    root.noteToKey[n] = name\n  }\n})()\n","import root from './root'\nimport './loader'\nimport './gm'\nimport './player'\nimport './plugins'\n\nwindow.MIDI = root\nmodule.exports = root\n","/* Wrapper for accessing strings through sequential reads */\nexport default function (str) {\n  var position = 0\n\n  function read (length) {\n    var result = str.substr(position, length)\n    position += length\n    return result\n  }\n\n  /* read a big-endian 32-bit integer */\n  function readInt32 () {\n    var result = (\n    (str.charCodeAt(position) << 24) +\n    (str.charCodeAt(position + 1) << 16) +\n    (str.charCodeAt(position + 2) << 8) +\n    str.charCodeAt(position + 3))\n    position += 4\n    return result\n  }\n\n  /* read a big-endian 16-bit integer */\n  function readInt16 () {\n    var result = (\n    (str.charCodeAt(position) << 8) +\n    str.charCodeAt(position + 1))\n    position += 2\n    return result\n  }\n\n  /* read an 8-bit integer */\n  function readInt8 (signed) {\n    var result = str.charCodeAt(position)\n    if (signed && result > 127) result -= 256\n    position += 1\n    return result\n  }\n\n  function eof () {\n    return position >= str.length\n  }\n\n  /* read a MIDI-style variable-length integer\n    (big-endian value in groups of 7 bits,\n    with top bit set to signify that another byte follows)\n  */\n  function readVarInt () {\n    var result = 0\n    while (true) {\n      var b = readInt8()\n      if (b & 0x80) {\n        result += (b & 0x7f)\n        result <<= 7\n      } else {\n        /* b is the last byte */\n        return result + b\n      }\n    }\n  }\n\n  return {\n    'eof': eof,\n    'read': read,\n    'readInt32': readInt32,\n    'readInt16': readInt16,\n    'readInt8': readInt8,\n    'readVarInt': readVarInt\n  }\n}\n","export * from './midifile'\nexport * from './replayer'\n","/**\n * class to parse the .mid file format\n * (depends on _stream.js)\n */\n\nimport Stream from './_stream'\n\nexport function MidiFile (data) {\n  var lastEventTypeByte\n\n  function readChunk (stream) {\n    var id = stream.read(4)\n    var length = stream.readInt32()\n    return {\n      'id': id,\n      'length': length,\n      'data': stream.read(length)\n    }\n  }\n\n  function readEvent (stream) {\n    var event = {}\n    event.deltaTime = stream.readVarInt()\n    var eventTypeByte = stream.readInt8()\n    if ((eventTypeByte & 0xf0) === 0xf0) {\n      /* system / meta event */\n      if (eventTypeByte === 0xff) {\n        /* meta event */\n        event.type = 'meta'\n        var subtypeByte = stream.readInt8()\n        let length = stream.readVarInt()\n        switch (subtypeByte) {\n          case 0x00:\n            event.subtype = 'sequenceNumber'\n            if (length !== 2) throw new Error('Expected length for sequenceNumber event is 2, got ' + length)\n            event.number = stream.readInt16()\n            return event\n          case 0x01:\n            event.subtype = 'text'\n            event.text = stream.read(length)\n            return event\n          case 0x02:\n            event.subtype = 'copyrightNotice'\n            event.text = stream.read(length)\n            return event\n          case 0x03:\n            event.subtype = 'trackName'\n            event.text = stream.read(length)\n            return event\n          case 0x04:\n            event.subtype = 'instrumentName'\n            event.text = stream.read(length)\n            return event\n          case 0x05:\n            event.subtype = 'lyrics'\n            event.text = stream.read(length)\n            return event\n          case 0x06:\n            event.subtype = 'marker'\n            event.text = stream.read(length)\n            return event\n          case 0x07:\n            event.subtype = 'cuePoint'\n            event.text = stream.read(length)\n            return event\n          case 0x20:\n            event.subtype = 'midiChannelPrefix'\n            if (length !== 1) throw new Error('Expected length for midiChannelPrefix event is 1, got ' + length)\n            event.channel = stream.readInt8()\n            return event\n          case 0x2f:\n            event.subtype = 'endOfTrack'\n            if (length !== 0) throw new Error('Expected length for endOfTrack event is 0, got ' + length)\n            return event\n          case 0x51:\n            event.subtype = 'setTempo'\n            if (length !== 3) throw new Error('Expected length for setTempo event is 3, got ' + length)\n            event.microsecondsPerBeat = (\n              (stream.readInt8() << 16) +\n              (stream.readInt8() << 8) +\n              stream.readInt8()\n            )\n            return event\n          case 0x54:\n            event.subtype = 'smpteOffset'\n            if (length !== 5) throw new Error('Expected length for smpteOffset event is 5, got ' + length)\n            var hourByte = stream.readInt8()\n            event.frameRate = {\n              0x00: 24, 0x20: 25, 0x40: 29, 0x60: 30\n            }[hourByte & 0x60]\n            event.hour = hourByte & 0x1f\n            event.min = stream.readInt8()\n            event.sec = stream.readInt8()\n            event.frame = stream.readInt8()\n            event.subframe = stream.readInt8()\n            return event\n          case 0x58:\n            event.subtype = 'timeSignature'\n            if (length !== 4) throw new Error('Expected length for timeSignature event is 4, got ' + length)\n            event.numerator = stream.readInt8()\n            event.denominator = Math.pow(2, stream.readInt8())\n            event.metronome = stream.readInt8()\n            event.thirtyseconds = stream.readInt8()\n            return event\n          case 0x59:\n            event.subtype = 'keySignature'\n            if (length !== 2) throw new Error('Expected length for keySignature event is 2, got ' + length)\n            event.key = stream.readInt8(true)\n            event.scale = stream.readInt8()\n            return event\n          case 0x7f:\n            event.subtype = 'sequencerSpecific'\n            event.data = stream.read(length)\n            return event\n          default:\n            // console.log(\"Unrecognised meta event subtype: \" + subtypeByte)\n            event.subtype = 'unknown'\n            event.data = stream.read(length)\n            return event\n        }\n        // event.data = stream.read(length)\n        // return event\n      } else if (eventTypeByte === 0xf0) {\n        event.type = 'sysEx'\n        let length = stream.readVarInt()\n        event.data = stream.read(length)\n        return event\n      } else if (eventTypeByte === 0xf7) {\n        event.type = 'dividedSysEx'\n        let length = stream.readVarInt()\n        event.data = stream.read(length)\n        return event\n      } else {\n        throw new Error('Unrecognised MIDI event type byte: ' + eventTypeByte)\n      }\n    } else {\n      /* channel event */\n      var param1\n      if ((eventTypeByte & 0x80) === 0) {\n        /* running status - reuse lastEventTypeByte as the event type.\n          eventTypeByte is actually the first parameter\n        */\n        param1 = eventTypeByte\n        eventTypeByte = lastEventTypeByte\n      } else {\n        param1 = stream.readInt8()\n        lastEventTypeByte = eventTypeByte\n      }\n      var eventType = eventTypeByte >> 4\n      event.channel = eventTypeByte & 0x0f\n      event.type = 'channel'\n      switch (eventType) {\n        case 0x08:\n          event.subtype = 'noteOff'\n          event.noteNumber = param1\n          event.velocity = stream.readInt8()\n          return event\n        case 0x09:\n          event.noteNumber = param1\n          event.velocity = stream.readInt8()\n          if (event.velocity === 0) {\n            event.subtype = 'noteOff'\n          } else {\n            event.subtype = 'noteOn'\n          }\n          return event\n        case 0x0a:\n          event.subtype = 'noteAftertouch'\n          event.noteNumber = param1\n          event.amount = stream.readInt8()\n          return event\n        case 0x0b:\n          event.subtype = 'controller'\n          event.controllerType = param1\n          event.value = stream.readInt8()\n          return event\n        case 0x0c:\n          event.subtype = 'programChange'\n          event.programNumber = param1\n          return event\n        case 0x0d:\n          event.subtype = 'channelAftertouch'\n          event.amount = param1\n          return event\n        case 0x0e:\n          event.subtype = 'pitchBend'\n          event.value = param1 + (stream.readInt8() << 7)\n          return event\n        default:\n          throw new Error('Unrecognised MIDI event type: ' + eventType)\n      /*\n      console.log(\"Unrecognised MIDI event type: \" + eventType)\n      stream.readInt8()\n      event.subtype = 'unknown'\n      return event\n      */\n      }\n    }\n  }\n\n  const stream = Stream(data)\n  var headerChunk = readChunk(stream)\n  if (headerChunk.id !== 'MThd' || headerChunk.length !== 6) {\n    throw new Error('Bad .mid file - header not found')\n  }\n  var headerStream = Stream(headerChunk.data)\n  var formatType = headerStream.readInt16()\n  var trackCount = headerStream.readInt16()\n  var timeDivision = headerStream.readInt16()\n  var ticksPerBeat\n\n  if (timeDivision & 0x8000) {\n    throw new Error('Expressing time division in SMTPE frames is not supported yet')\n  } else {\n    ticksPerBeat = timeDivision\n  }\n\n  var header = {\n    'formatType': formatType,\n    'trackCount': trackCount,\n    'ticksPerBeat': ticksPerBeat\n  }\n  var tracks = []\n  for (var i = 0; i < header.trackCount; i++) {\n    tracks[i] = []\n    var trackChunk = readChunk(stream)\n    if (trackChunk.id !== 'MTrk') {\n      throw new Error('Unexpected chunk - expected MTrk, got ' + trackChunk.id)\n    }\n    var trackStream = Stream(trackChunk.data)\n    while (!trackStream.eof()) {\n      var event = readEvent(trackStream)\n      tracks[i].push(event)\n    // console.log(event)\n    }\n  }\n\n  return {\n    'header': header,\n    'tracks': tracks\n  }\n}\n","const clone = function (o) {\n  if (typeof o !== 'object') return (o)\n  if (o === null) return (o)\n  var ret = (typeof o.length === 'number') ? [] : {}\n  for (var key in o) ret[key] = clone(o[key])\n  return ret\n}\n\nexport function Replayer (midiFile, timeWarp, eventProcessor, bpm) {\n  var trackStates = []\n  var beatsPerMinute = bpm || 120\n  var bpmOverride = !!bpm\n  var ticksPerBeat = midiFile.header.ticksPerBeat\n\n  for (let i = 0; i < midiFile.tracks.length; i++) {\n    trackStates[i] = {\n      'nextEventIndex': 0,\n      'ticksToNextEvent': (midiFile.tracks[i].length ? midiFile.tracks[i][0].deltaTime : null)\n    }\n  }\n\n  function getNextEvent () {\n    var ticksToNextEvent = null\n    var nextEventTrack = null\n    var nextEventIndex = null\n\n    for (let i = 0; i < trackStates.length; i++) {\n      if (\n        trackStates[i].ticksToNextEvent != null &&\n        (ticksToNextEvent == null || trackStates[i].ticksToNextEvent < ticksToNextEvent)\n      ) {\n        ticksToNextEvent = trackStates[i].ticksToNextEvent\n        nextEventTrack = i\n        nextEventIndex = trackStates[i].nextEventIndex\n      }\n    }\n    if (nextEventTrack != null) {\n      /* consume event from that track */\n      var nextEvent = midiFile.tracks[nextEventTrack][nextEventIndex]\n      if (midiFile.tracks[nextEventTrack][nextEventIndex + 1]) {\n        trackStates[nextEventTrack].ticksToNextEvent += midiFile.tracks[nextEventTrack][nextEventIndex + 1].deltaTime\n      } else {\n        trackStates[nextEventTrack].ticksToNextEvent = null\n      }\n      trackStates[nextEventTrack].nextEventIndex += 1\n      /* advance timings on all tracks by ticksToNextEvent */\n      for (let i = 0; i < trackStates.length; i++) {\n        if (trackStates[i].ticksToNextEvent != null) {\n          trackStates[i].ticksToNextEvent -= ticksToNextEvent\n        }\n      }\n      return {\n        'ticksToEvent': ticksToNextEvent,\n        'event': nextEvent,\n        'track': nextEventTrack\n      }\n    } else {\n      return null\n    }\n  }\n  //\n  var midiEvent\n  var temporal = []\n  ~(function processEvents () {\n    function processNext () {\n      if (!bpmOverride && midiEvent.event.type === 'meta' && midiEvent.event.subtype === 'setTempo') {\n        // tempo change events can occur anywhere in the middle and affect events that follow\n        beatsPerMinute = 60000000 / midiEvent.event.microsecondsPerBeat\n      }\n      // /\n      var beatsToGenerate = 0\n      var secondsToGenerate = 0\n      if (midiEvent.ticksToEvent > 0) {\n        beatsToGenerate = midiEvent.ticksToEvent / ticksPerBeat\n        secondsToGenerate = beatsToGenerate / (beatsPerMinute / 60)\n      }\n      // /\n      var time = (secondsToGenerate * 1000 * timeWarp) || 0\n      temporal.push([midiEvent, time])\n      midiEvent = getNextEvent()\n    }\n    // /\n    midiEvent = getNextEvent()\n    if (midiEvent) {\n      while (midiEvent) processNext(true)\n    }\n  })()\n\n  return {\n    getData: function () {\n      return clone(temporal)\n    }\n  }\n}\n","/*\n  ----------------------------------------------------------\n  root.Plugin : 0.3.4 : 2015-03-26\n  ----------------------------------------------------------\n  https://github.com/mudcube/root.js\n  ----------------------------------------------------------\n  Inspired by javax.sound.midi (albeit a super simple version):\n    http://docs.oracle.com/javase/6/docs/api/javax/sound/midi/package-summary.html\n  ----------------------------------------------------------\n  Technologies\n  ----------------------------------------------------------\n    Web MIDI API - no native support yet (jazzplugin)\n    Web Audio API - firefox 25+, chrome 10+, safari 6+, opera 15+\n    HTML5 Audio Tag - ie 9+, firefox 3.5+, chrome 4+, safari 4+, opera 9.5+, ios 4+, android 2.3+\n  ----------------------------------------------------------\n*/\n\nimport { audioDetect, loadScript, request } from './utils'\nimport root from './root'\n\nroot.Soundfont = {}\nroot.DEBUG = true\nroot.USE_XHR = true\nroot.soundfontUrl = './soundfont/'\n\n/*\n  root.loadPlugin({\n    onsuccess: function() { },\n    onprogress: function(state, percent) { },\n    targetFormat: 'mp3', // optionally can force to use MP3 (for instance on mobile networks)\n    instrument: 'acoustic_grand_piano', // or 1 (default)\n    instruments: [ 'acoustic_grand_piano', 'acoustic_guitar_nylon' ] // or multiple instruments\n  })\n*/\n\nroot.loadPlugin = function (opts) {\n  if (typeof opts === 'function') {\n    opts = {onsuccess: opts}\n  }\n\n  root.soundfontUrl = opts.soundfontUrl || root.soundfontUrl\n\n  // / Detect the best type of audio to use\n  audioDetect(function (supports) {\n    var hash = window.location.hash\n    var api = ''\n\n    // / use the most appropriate plugin if not specified\n    if (supports[opts.api]) {\n      api = opts.api\n    } else if (supports[hash.substr(1)]) {\n      api = hash.substr(1)\n    } else if (supports.webmidi) {\n      api = 'webmidi'\n    } else if (window.AudioContext) { // Chrome\n      api = 'webaudio'\n    } else if (window.Audio) { // Firefox\n      api = 'audiotag'\n    }\n\n    if (connect[api]) {\n      // / use audio/ogg when supported\n      let audioFormat\n      if (opts.targetFormat) {\n        audioFormat = opts.targetFormat\n      } else { // use best quality\n        audioFormat = supports['audio/ogg'] ? 'ogg' : 'mp3'\n      }\n\n      // / load the specified plugin\n      root.__api = api\n      root.__audioFormat = audioFormat\n      root.supports = supports\n      root.loadResource(opts)\n    }\n  })\n}\n\n/*\n  root.loadResource({\n    onsuccess: function() { },\n    onprogress: function(state, percent) { },\n    instrument: 'banjo'\n  })\n*/\n\nroot.loadResource = function (opts) {\n  var instruments = opts.instruments || opts.instrument || 'acoustic_grand_piano'\n  // /\n  if (typeof instruments !== 'object') {\n    if (instruments || instruments === 0) {\n      instruments = [instruments]\n    } else {\n      instruments = []\n    }\n  }\n  // / convert numeric ids into strings\n  for (var i = 0; i < instruments.length; i++) {\n    var instrument = instruments[i]\n    if (instrument === +instrument) { // is numeric\n      if (root.GM.byId[instrument]) {\n        instruments[i] = root.GM.byId[instrument].id\n      }\n    }\n  }\n  // /\n  opts.format = root.__audioFormat\n  opts.instruments = instruments\n  // /\n  connect[root.__api](opts)\n}\n\nvar connect = {\n  webmidi: function (opts) {\n    // cant wait for this to be standardized!\n    root.WebMIDI.connect(opts)\n  },\n  audiotag: function (opts) {\n    // works ok, kinda like a drunken tuna fish, across the board\n    // http://caniuse.com/audio\n    requestQueue(opts, 'AudioTag')\n  },\n  webaudio: function (opts) {\n    // works awesome! safari, chrome and firefox support\n    // http://caniuse.com/web-audio\n    requestQueue(opts, 'WebAudio')\n  }\n}\n\nvar requestQueue = function (opts, context) {\n  var audioFormat = opts.format\n  var instruments = opts.instruments\n  var onprogress = opts.onprogress\n  var onerror = opts.onerror\n  // /\n  var length = instruments.length\n  var pending = length\n  var waitForEnd = function () {\n    if (!--pending) {\n      onprogress && onprogress('load', 1.0)\n      root[context].connect(opts)\n    }\n  }\n  // /\n  for (var i = 0; i < length; i++) {\n    var instrumentId = instruments[i]\n    if (root.Soundfont[instrumentId]) { // already loaded\n      waitForEnd()\n    } else { // needs to be requested\n      sendRequest(instruments[i], audioFormat, function (evt, progress) {\n        var fileProgress = progress / length\n        var queueProgress = (length - pending) / length\n        onprogress && onprogress('load', fileProgress + queueProgress, instrumentId)\n      }, function () {\n        waitForEnd()\n      }, onerror)\n    }\n  }\n}\n\nvar sendRequest = function (instrumentId, audioFormat, onprogress, onsuccess, onerror) {\n  var soundfontPath = root.soundfontUrl + instrumentId + '-' + audioFormat + '.js'\n  if (root.USE_XHR) {\n    request({\n      url: soundfontPath,\n      format: 'text',\n      onerror: onerror,\n      onprogress: onprogress,\n      onsuccess: function (event, responseText) {\n        var script = document.createElement('script')\n        script.language = 'javascript'\n        script.type = 'text/javascript'\n        script.text = responseText\n        document.body.appendChild(script)\n        onsuccess()\n      }\n    })\n  } else {\n    loadScript.add({\n      url: soundfontPath,\n      verify: 'root.Soundfont[\"' + instrumentId + '\"]',\n      onerror: onerror,\n      onsuccess: function () {\n        onsuccess()\n      }\n    })\n  }\n}\n\nroot.setDefaultPlugin = function (midi) {\n  for (var key in midi) {\n    root[key] = midi[key]\n  }\n}\n","/*\n  ----------------------------------------------------------\n  midi.Player : 0.3.1 : 2015-03-26\n  ----------------------------------------------------------\n  https://github.com/mudcube/midi.js\n  ----------------------------------------------------------\n*/\n\nimport { MidiFile, Replayer } from './jasmid'\nimport root from './root'\n\n(function () {\n  root.Player = {}\n  const player = root.Player\n  player.currentTime = 0\n  player.endTime = 0\n  player.restart = 0\n  player.playing = false\n  player.timeWarp = 1\n  player.startDelay = 0\n  player.BPM = 120\n\n  player.start = player.resume = function (onsuccess) {\n    if (player.currentTime < -1) {\n      player.currentTime = -1\n    }\n    startAudio(player.currentTime, null, onsuccess)\n  }\n\n  player.pause = function () {\n    var tmp = player.restart\n    stopAudio()\n    player.restart = tmp\n  }\n\n  player.stop = function () {\n    stopAudio()\n    player.restart = 0\n    player.currentTime = 0\n  }\n\n  player.addListener = function (onsuccess) {\n    onMidiEvent = onsuccess\n  }\n\n  player.removeListener = function () {\n    onMidiEvent = undefined\n  }\n\n  player.clearAnimation = function () {\n    if (player.animationFrameId) {\n      window.cancelAnimationFrame(player.animationFrameId)\n    }\n  }\n\n  player.setAnimation = function (callback) {\n    var currentTime = 0\n    var tOurTime = 0\n    var tTheirTime = 0\n    //\n    player.clearAnimation()\n    // /\n    var frame = function () {\n      player.animationFrameId = window.requestAnimationFrame(frame)\n      // /\n      if (player.endTime === 0) {\n        return\n      }\n      if (player.playing) {\n        currentTime = (tTheirTime === player.currentTime) ? tOurTime - Date.now() : 0\n        if (player.currentTime === 0) {\n          currentTime = 0\n        } else {\n          currentTime = player.currentTime - currentTime\n        }\n        if (tTheirTime !== player.currentTime) {\n          tOurTime = Date.now()\n          tTheirTime = player.currentTime\n        }\n      } else { // paused\n        currentTime = player.currentTime\n      }\n      // /\n      var endTime = player.endTime\n      // var percent = currentTime / endTime\n      var total = currentTime / 1000\n      var minutes = total / 60\n      var seconds = total - (minutes * 60)\n      var t1 = minutes * 60 + seconds\n      var t2 = (endTime / 1000)\n      // /\n      if (t2 - t1 < -1.0) {\n        return\n      } else {\n        callback({\n          now: t1,\n          end: t2,\n          events: noteRegistrar\n        })\n      }\n    }\n    // /\n    window.requestAnimationFrame(frame)\n  }\n\n  // helpers\n\n  player.loadMidiFile = function (onsuccess, onprogress, onerror) {\n    try {\n      // console.log(MidiFile(player.currentData), new Replayer(MidiFile(player.currentData), player.timeWarp, null, player.BPM))\n      player.replayer = new Replayer(MidiFile(player.currentData), player.timeWarp, null, player.BPM)\n      player.data = player.replayer.getData()\n      player.endTime = getLength()\n      // /\n      root.loadPlugin({\n        // instruments: player.getFileInstruments(),\n        onsuccess: onsuccess,\n        onprogress: onprogress,\n        onerror: onerror\n      })\n    } catch (event) {\n      console.error(event)\n      onerror && onerror(event)\n    }\n  }\n\n  player.loadFile = function (file, onsuccess, onprogress, onerror) {\n    player.stop()\n    if (file.indexOf('base64,') !== -1) {\n      var data = window.atob(file.split(',')[1])\n      player.currentData = data\n      player.loadMidiFile(onsuccess, onprogress, onerror)\n    } else {\n      var fetch = new window.XMLHttpRequest()\n      fetch.open('GET', file)\n      fetch.overrideMimeType('text/plain; charset=x-user-defined')\n      fetch.onreadystatechange = function () {\n        if (this.readyState === 4) {\n          if (this.status === 200) {\n            var t = this.responseText || ''\n            var ff = []\n            var mx = t.length\n            var scc = String.fromCharCode\n            for (var z = 0; z < mx; z++) {\n              ff[z] = scc(t.charCodeAt(z) & 255)\n            }\n            // /\n            var data = ff.join('')\n            player.currentData = data\n            player.loadMidiFile(onsuccess, onprogress, onerror)\n          } else {\n            onerror && onerror('Unable to load MIDI file')\n          }\n        }\n      }\n      fetch.send()\n    }\n  }\n\n  player.getFileInstruments = function () {\n    var instruments = {}\n    var programs = {}\n    for (var n = 0; n < player.data.length; n++) {\n      var event = player.data[n][0].event\n      if (event.type !== 'channel') {\n        continue\n      }\n      var channel = event.channel\n      switch (event.subtype) {\n        case 'controller':\n          //        console.log(event.channel, root.defineControl[event.controllerType], event.value)\n          break\n        case 'programChange':\n          programs[channel] = event.programNumber\n          break\n        case 'noteOn':\n          var program = programs[channel]\n          var gm = root.GM.byId[isFinite(program) ? program : channel]\n          instruments[gm.id] = true\n          break\n      }\n    }\n    var ret = []\n    for (var key in instruments) {\n      ret.push(key)\n    }\n    return ret\n  }\n\n  // Playing the audio\n\n  var eventQueue = [] // hold events to be triggered\n  var queuedTime //\n  var startTime = 0 // to measure time elapse\n  var noteRegistrar = {} // get event for requested note\n  var onMidiEvent // listener\n  var scheduleTracking = function (channel, note, currentTime, offset, message, velocity, time) {\n    return setTimeout(function () {\n      var data = {\n        channel: channel,\n        note: note,\n        now: currentTime,\n        end: player.endTime,\n        message: message,\n        velocity: velocity\n      }\n      //\n      if (message === 128) {\n        delete noteRegistrar[note]\n      } else {\n        noteRegistrar[note] = data\n      }\n      if (onMidiEvent) {\n        onMidiEvent(data)\n      }\n      player.currentTime = currentTime\n      // /\n      eventQueue.shift()\n      // /\n      if (eventQueue.length < 1000) {\n        startAudio(queuedTime, true)\n      } else if (player.currentTime === queuedTime && queuedTime < player.endTime) { // grab next sequence\n        startAudio(queuedTime, true)\n      }\n    }, currentTime - offset)\n  }\n\n  var getContext = function () {\n    if (root.api === 'webaudio') {\n      return root.WebAudio.getContext()\n    } else {\n      player.ctx = {currentTime: 0}\n    }\n    return player.ctx\n  }\n\n  var getLength = function () {\n    var data = player.data\n    var length = data.length\n    var totalTime = 0.5\n    for (var n = 0; n < length; n++) {\n      totalTime += data[n][1]\n    }\n    return totalTime\n  }\n\n  var __now\n  var getNow = function () {\n    if (window.performance && window.performance.now) {\n      return window.performance.now()\n    } else {\n      return Date.now()\n    }\n  }\n\n  var startAudio = function (currentTime, fromCache, onsuccess) {\n    if (!player.replayer) {\n      return\n    }\n    if (!fromCache) {\n      if (typeof currentTime === 'undefined') {\n        currentTime = player.restart\n      }\n      // /\n      player.playing && stopAudio()\n      player.playing = true\n      player.data = player.replayer.getData()\n      player.endTime = getLength()\n    }\n    // /\n    var note\n    var offset = 0\n    var messages = 0\n    var data = player.data\n    var ctx = getContext()\n    var length = data.length\n    //\n    queuedTime = 0.5\n    // /\n    // var interval = eventQueue[0] && eventQueue[0].interval || 0\n    var foffset = currentTime - player.currentTime\n    // /\n    if (root.api !== 'webaudio') { // set currentTime on ctx\n      var now = getNow()\n      __now = __now || now\n      ctx.currentTime = (now - __now) / 1000\n    }\n    // /\n    startTime = ctx.currentTime\n    // /\n    for (var n = 0; n < length && messages < 100; n++) {\n      var obj = data[n]\n      if ((queuedTime += obj[1]) <= currentTime) {\n        offset = queuedTime\n        continue\n      }\n      // /\n      currentTime = queuedTime - offset\n      // /\n      var event = obj[0].event\n      if (event.type !== 'channel') {\n        continue\n      }\n      // /\n      var channelId = event.channel\n      var channel = root.channels[channelId]\n      var delay = ctx.currentTime + ((currentTime + foffset + player.startDelay) / 1000)\n      var queueTime = queuedTime - offset + player.startDelay\n      switch (event.subtype) {\n        case 'controller':\n          root.setController(channelId, event.controllerType, event.value, delay)\n          break\n        case 'programChange':\n          root.programChange(channelId, event.programNumber, delay)\n          break\n        case 'pitchBend':\n          root.pitchBend(channelId, event.value, delay)\n          break\n        case 'noteOn':\n          if (channel.mute) break\n          note = event.noteNumber - (player.MIDIOffset || 0)\n          eventQueue.push({\n            event: event,\n            time: queueTime,\n            source: root.noteOn(channelId, event.noteNumber, event.velocity, delay),\n            interval: scheduleTracking(channelId, note, queuedTime + player.startDelay, offset - foffset, 144, event.velocity)\n          })\n          messages++\n          break\n        case 'noteOff':\n          if (channel.mute) break\n          note = event.noteNumber - (player.MIDIOffset || 0)\n          eventQueue.push({\n            event: event,\n            time: queueTime,\n            source: root.noteOff(channelId, event.noteNumber, delay),\n            interval: scheduleTracking(channelId, note, queuedTime, offset - foffset, 128, 0)\n          })\n          break\n        default:\n          break\n      }\n    }\n    // /\n    onsuccess && onsuccess(eventQueue)\n  }\n\n  var stopAudio = function () {\n    var ctx = getContext()\n    player.playing = false\n    player.restart += (ctx.currentTime - startTime) * 1000\n    // stop the audio, and intervals\n    while (eventQueue.length) {\n      let o = eventQueue.pop()\n      window.clearInterval(o.interval)\n      if (!o.source) continue // is not webaudio\n      if (typeof (o.source) === 'number') {\n        window.clearTimeout(o.source)\n      } else { // webaudio\n        o.source.disconnect(0)\n      }\n    }\n    // run callback to cancel any notes still playing\n    for (var key in noteRegistrar) {\n      let o = noteRegistrar[key]\n      if (noteRegistrar[key].message === 144 && onMidiEvent) {\n        onMidiEvent({\n          channel: o.channel,\n          note: o.note,\n          now: o.now,\n          end: o.end,\n          message: 128,\n          velocity: o.velocity\n        })\n      }\n    }\n    // reset noteRegistrar\n    noteRegistrar = {}\n  }\n})()\n","/*\n  ----------------------------------------------------------------------\n  AudioTag <audio> - OGG or MPEG Soundbank\n  ----------------------------------------------------------------------\n  http://dev.w3.org/html5/spec/Overview.html#the-audio-element\n  ----------------------------------------------------------------------\n*/\nimport root from '../root'\n\nwindow.Audio && (function () {\n  var midi = root.AudioTag = { api: 'audiotag' }\n  var noteToKey = {}\n  var volume = 127 // floating point\n  var bufferNid = -1 // current channel\n  var audioBuffers = [] // the audio channels\n  var notesOn = [] // instrumentId + noteId that is currently playing in each 'channel', for routing noteOff/chordOff calls\n  var notes = {} // the piano keys\n  for (let nid = 0; nid < 12; nid++) {\n    audioBuffers[nid] = new window.Audio()\n  }\n\n  var playChannel = function (channel, note) {\n    if (!root.channels[channel]) return\n    var instrument = root.channels[channel].instrument\n    var instrumentId = root.GM.byId[instrument].id\n    note = notes[note]\n    if (note) {\n      var instrumentNoteId = instrumentId + '' + note.id\n      var nid = (bufferNid + 1) % audioBuffers.length\n      var audio = audioBuffers[nid]\n      notesOn[ nid ] = instrumentNoteId\n      if (!root.Soundfont[instrumentId]) {\n        if (root.DEBUG) {\n          console.log('404', instrumentId)\n        }\n        return\n      }\n      audio.src = root.Soundfont[instrumentId][note.id]\n      audio.volume = volume / 127\n      audio.play()\n      bufferNid = nid\n    }\n  }\n\n  var stopChannel = function (channel, note) {\n    if (!root.channels[channel]) return\n    var instrument = root.channels[channel].instrument\n    var instrumentId = root.GM.byId[instrument].id\n    note = notes[note]\n    if (note) {\n      var instrumentNoteId = instrumentId + '' + note.id\n      for (var i = 0, len = audioBuffers.length; i < len; i++) {\n        var nid = (i + bufferNid + 1) % len\n        var cId = notesOn[nid]\n        if (cId && cId === instrumentNoteId) {\n          audioBuffers[nid].pause()\n          notesOn[nid] = null\n          return\n        }\n      }\n    }\n  }\n\n  midi.audioBuffers = audioBuffers\n  midi.send = function (data, delay) {}\n  midi.setController = function (channel, type, value, delay) {}\n  midi.setVolume = function (channel, n) {\n    volume = n // - should be channel specific volume\n  }\n\n  midi.programChange = function (channel, program) {\n    root.channels[channel].instrument = program\n  }\n\n  midi.pitchBend = function (channel, program, delay) {}\n\n  midi.noteOn = function (channel, note, velocity, delay) {\n    var id = noteToKey[note]\n    if (!notes[id]) return\n    if (delay) {\n      return setTimeout(function () {\n        playChannel(channel, id)\n      }, delay * 1000)\n    } else {\n      playChannel(channel, id)\n    }\n  }\n\n  midi.noteOff = function (channel, note, delay) {\n    //      var id = noteToKey[note]\n    //      if (!notes[id]) return\n    //      if (delay) {\n    //        return setTimeout(function() {\n    //          stopChannel(channel, id)\n    //        }, delay * 1000)\n    //      } else {\n    //        stopChannel(channel, id)\n    //      }\n  }\n\n  midi.chordOn = function (channel, chord, velocity, delay) {\n    for (var idx = 0; idx < chord.length; idx++) {\n      var n = chord[idx]\n      var id = noteToKey[n]\n      if (!notes[id]) continue\n      if (delay) {\n        return setTimeout(function () {\n          playChannel(channel, id)\n        }, delay * 1000)\n      } else {\n        playChannel(channel, id)\n      }\n    }\n  }\n\n  midi.chordOff = function (channel, chord, delay) {\n    for (var idx = 0; idx < chord.length; idx++) {\n      var n = chord[idx]\n      var id = noteToKey[n]\n      if (!notes[id]) continue\n      if (delay) {\n        return setTimeout(function () {\n          stopChannel(channel, id)\n        }, delay * 1000)\n      } else {\n        stopChannel(channel, id)\n      }\n    }\n  }\n\n  midi.stopAllNotes = function () {\n    for (var nid = 0, length = audioBuffers.length; nid < length; nid++) {\n      audioBuffers[nid].pause()\n    }\n  }\n\n  midi.connect = function (opts) {\n    root.setDefaultPlugin(midi)\n    // /\n    for (var key in root.keyToNote) {\n      noteToKey[root.keyToNote[key]] = key\n      notes[key] = {id: key}\n    }\n    // /\n    opts.onsuccess && opts.onsuccess()\n  }\n})()\n","import './audiotag'\nimport './webaudio'\nimport './webmidi'\n","/*\n  ----------------------------------------------------------\n  Web Audio API - OGG or MPEG Soundbank\n  ----------------------------------------------------------\n  http://webaudio.github.io/web-audio-api/\n  ----------------------------------------------------------\n*/\nimport root from '../root'\n\n// REF: http://stackoverflow.com/questions/21797299/convert-base64-string-to-arraybuffer\nfunction base64ToArrayBuffer (base64) {\n  var binaryString = window.atob(base64)\n  var len = binaryString.length\n  var bytes = new Uint8Array(len)\n  for (var i = 0; i < len; i++) {\n    bytes[i] = binaryString.charCodeAt(i)\n  }\n  return bytes.buffer\n}\n\nwindow.AudioContext && (function () {\n  // var audioContext = null // new AudioContext()\n  var useStreamingBuffer = false // !!audioContext.createMediaElementSource\n  var midi = root.WebAudio = { api: 'webaudio' }\n  var ctx // audio context\n  var sources = {}\n  var effects = {}\n  var masterVolume = 127\n  var audioBuffers = {}\n  // /\n  midi.audioBuffers = audioBuffers\n  midi.send = function (data, delay) {}\n  midi.setController = function (channelId, type, value, delay) {}\n\n  midi.setVolume = function (channelId, volume, delay) {\n    if (delay) {\n      setTimeout(function () {\n        masterVolume = volume\n      }, delay * 1000)\n    } else {\n      masterVolume = volume\n    }\n  }\n\n  midi.programChange = function (channelId, program, delay) {\n    //      if (delay) {\n    //        return setTimeout(function() {\n    //          var channel = root.channels[channelId]\n    //          channel.instrument = program\n    //        }, delay)\n    //      } else {\n    var channel = root.channels[channelId]\n    channel.instrument = program\n  //      }\n  }\n\n  midi.pitchBend = function (channelId, program, delay) {\n    //      if (delay) {\n    //        setTimeout(function() {\n    //          var channel = root.channels[channelId]\n    //          channel.pitchBend = program\n    //        }, delay)\n    //      } else {\n    var channel = root.channels[channelId]\n    channel.pitchBend = program\n  //      }\n  }\n\n  midi.noteOn = function (channelId, noteId, velocity, delay) {\n    delay = delay || 0\n\n    // / check whether the note exists\n    var channel = root.channels[channelId]\n    var instrument = channel.instrument\n    var bufferId = instrument + '' + noteId\n    var buffer = audioBuffers[bufferId]\n    if (!buffer) {\n      //        console.log(midi.GM.byId[instrument].id, instrument, channelId)\n      return\n    }\n\n    // / convert relative delay to absolute delay\n    if (delay < ctx.currentTime) {\n      delay += ctx.currentTime\n    }\n\n    // / create audio buffer\n    var source\n    if (useStreamingBuffer) {\n      source = ctx.createMediaElementSource(buffer)\n    } else { // XMLHTTP buffer\n      source = ctx.createBufferSource()\n      source.buffer = buffer\n    }\n\n    // / add effects to buffer\n    if (effects) {\n      var chain = source\n      for (var key in effects) {\n        chain.connect(effects[key].input)\n        chain = effects[key]\n      }\n    }\n\n    // / add gain + pitchShift\n    var gain = (velocity / 127) * (masterVolume / 127) * 2 - 1\n    source.connect(ctx.destination)\n    source.playbackRate.value = 1 // pitch shift\n    source.gainNode = ctx.createGain() // gain\n    source.gainNode.connect(ctx.destination)\n    source.gainNode.gain.value = Math.min(1.0, Math.max(-1.0, gain))\n    source.connect(source.gainNode)\n    // /\n    if (useStreamingBuffer) {\n      if (delay) {\n        return setTimeout(function () {\n          buffer.currentTime = 0\n          buffer.play()\n        }, delay * 1000)\n      } else {\n        buffer.currentTime = 0\n        buffer.play()\n      }\n    } else {\n      source.start(delay || 0)\n    }\n    // /\n    sources[channelId + '' + noteId] = source\n    // /\n    return source\n  }\n\n  midi.noteOff = function (channelId, noteId, delay) {\n    delay = delay || 0\n\n    // / check whether the note exists\n    var channel = root.channels[channelId]\n    var instrument = channel.instrument\n    var bufferId = instrument + '' + noteId\n    var buffer = audioBuffers[bufferId]\n    if (buffer) {\n      if (delay < ctx.currentTime) {\n        delay += ctx.currentTime\n      }\n      // /\n      var source = sources[channelId + '' + noteId]\n      if (source) {\n        if (source.gainNode) {\n          // @Miranet: 'the values of 0.2 and 0.3 could of course be used as\n          // a 'release' parameter for ADSR like time settings.'\n          // add { 'metadata': { release: 0.3 } } to soundfont files\n          var gain = source.gainNode.gain\n          gain.linearRampToValueAtTime(gain.value, delay)\n          gain.linearRampToValueAtTime(-1.0, delay + 0.3)\n        }\n        // /\n        if (useStreamingBuffer) {\n          if (delay) {\n            setTimeout(function () {\n              buffer.pause()\n            }, delay * 1000)\n          } else {\n            buffer.pause()\n          }\n        } else {\n          if (source.noteOff) {\n            source.noteOff(delay + 0.5)\n          } else {\n            source.stop(delay + 0.5)\n          }\n        }\n        // /\n        delete sources[channelId + '' + noteId]\n        // /\n        return source\n      }\n    }\n  }\n\n  midi.chordOn = function (channel, chord, velocity, delay) {\n    var res = {}\n    for (var n = 0, note, len = chord.length; n < len; n++) {\n      res[note = chord[n]] = midi.noteOn(channel, note, velocity, delay)\n    }\n    return res\n  }\n\n  midi.chordOff = function (channel, chord, delay) {\n    var res = {}\n    for (var n = 0, note, len = chord.length; n < len; n++) {\n      res[note = chord[n]] = midi.noteOff(channel, note, delay)\n    }\n    return res\n  }\n\n  midi.stopAllNotes = function () {\n    for (var sid in sources) {\n      var delay = 0\n      if (delay < ctx.currentTime) {\n        delay += ctx.currentTime\n      }\n      var source = sources[sid]\n      source.gain.linearRampToValueAtTime(1, delay)\n      source.gain.linearRampToValueAtTime(0, delay + 0.3)\n      if (source.noteOff) { // old api\n        source.noteOff(delay + 0.3)\n      } else { // new api\n        source.stop(delay + 0.3)\n      }\n      delete sources[sid]\n    }\n  }\n\n  midi.setEffects = function (list) {\n    if (ctx.tunajs) {\n      for (var n = 0; n < list.length; n++) {\n        var data = list[n]\n        var effect = new ctx.tunajs[data.type](data)\n        effect.connect(ctx.destination)\n        effects[data.type] = effect\n      }\n    } else {\n      return console.log('Effects module not installed.')\n    }\n  }\n\n  midi.connect = function (opts) {\n    root.setDefaultPlugin(midi)\n    midi.setContext(ctx || createAudioContext(), opts.onsuccess)\n  }\n\n  midi.getContext = function () {\n    return ctx\n  }\n\n  midi.setContext = function (newCtx, onload, onprogress, onerror) {\n    ctx = newCtx\n\n    // / tuna.js effects module - https://github.com/Dinahmoe/tuna\n    if (typeof window.Tuna !== 'undefined' && !ctx.tunajs) {\n      ctx.tunajs = new window.Tuna(ctx)\n    }\n\n    // / loading audio files\n    var urls = []\n    var notes = root.keyToNote\n    for (let key in notes) urls.push(key)\n    // /\n    var waitForEnd = function (instrument) {\n      for (let key in bufferPending) { // has pending items\n        if (bufferPending[key]) return\n      }\n      // /\n      if (onload) { // run onload once\n        onload()\n        onload = null\n      }\n    }\n    // /\n    var requestAudio = function (soundfont, instrumentId, index, key) {\n      var url = soundfont[key]\n      if (url) {\n        bufferPending[instrumentId]++\n        loadAudio(url, function (buffer) {\n          buffer.id = key\n          var noteId = root.keyToNote[key]\n          audioBuffers[instrumentId + '' + noteId] = buffer\n          // /\n          if (--bufferPending[instrumentId] === 0) {\n            // var percent = index / 87\n            //              console.log(midi.GM.byId[instrumentId], 'processing: ', percent)\n            soundfont.isLoaded = true\n            waitForEnd(instrument)\n          }\n        }, function (err) {\n          console.error(err)\n        })\n      }\n    }\n    // /\n    var bufferPending = {}\n    for (var instrument in root.Soundfont) {\n      var soundfont = root.Soundfont[instrument]\n      if (soundfont.isLoaded) {\n        continue\n      }\n      // /\n      var synth = root.GM.byName[instrument]\n      var instrumentId = synth.number\n      // /\n      bufferPending[instrumentId] = 0\n      // /\n      for (let index = 0; index < urls.length; index++) {\n        let key = urls[index]\n        requestAudio(soundfont, instrumentId, index, key)\n      }\n    }\n    // /\n    setTimeout(waitForEnd, 1)\n  }\n\n  /* Load audio file: streaming | base64 | arraybuffer\n  ---------------------------------------------------------------------- */\n  function loadAudio (url, onload, onerror) {\n    if (useStreamingBuffer) {\n      var audio = new window.Audio()\n      audio.src = url\n      audio.controls = false\n      audio.autoplay = false\n      audio.preload = false\n      audio.addEventListener('canplay', function () {\n        onload && onload(audio)\n      })\n      audio.addEventListener('error', function (err) {\n        onerror && onerror(err)\n      })\n      document.body.appendChild(audio)\n    } else if (url.indexOf('data:audio') === 0) { // Base64 string\n      var base64 = url.split(',')[1]\n      var buffer = base64ToArrayBuffer(base64)\n      ctx.decodeAudioData(buffer, onload, onerror)\n    } else { // XMLHTTP buffer\n      var request = new window.XMLHttpRequest()\n      request.open('GET', url, true)\n      request.responseType = 'arraybuffer'\n      request.onload = function () {\n        ctx.decodeAudioData(request.response, onload, onerror)\n      }\n      request.send()\n    }\n  }\n\n  function createAudioContext () {\n    return new (window.AudioContext || window.webkitAudioContext)()\n  }\n})()\n","/*\n  ----------------------------------------------------------------------\n  Web MIDI API - Native Soundbanks\n  ----------------------------------------------------------------------\n  http://webaudio.github.io/web-midi-api/\n  ----------------------------------------------------------------------\n*/\nimport root from '../root'\n\n(function () {\n  var plugin = null\n  var output = null\n  var midi = root.WebMIDI = {api: 'webmidi'}\n  midi.send = function (data, delay) { // set channel volume\n    output.send(data, delay * 1000)\n  }\n\n  midi.setController = function (channel, type, value, delay) {\n    output.send([channel, type, value], delay * 1000)\n  }\n\n  midi.setVolume = function (channel, volume, delay) { // set channel volume\n    output.send([0xB0 + channel, 0x07, volume], delay * 1000)\n  }\n\n  midi.programChange = function (channel, program, delay) { // change patch (instrument)\n    output.send([0xC0 + channel, program], delay * 1000)\n  }\n\n  midi.pitchBend = function (channel, program, delay) { // pitch bend\n    output.send([0xE0 + channel, program], delay * 1000)\n  }\n\n  midi.noteOn = function (channel, note, velocity, delay) {\n    output.send([0x90 + channel, note, velocity], delay * 1000)\n  }\n\n  midi.noteOff = function (channel, note, delay) {\n    output.send([0x80 + channel, note, 0], delay * 1000)\n  }\n\n  midi.chordOn = function (channel, chord, velocity, delay) {\n    for (var n = 0; n < chord.length; n++) {\n      var note = chord[n]\n      output.send([0x90 + channel, note, velocity], delay * 1000)\n    }\n  }\n\n  midi.chordOff = function (channel, chord, delay) {\n    for (var n = 0; n < chord.length; n++) {\n      var note = chord[n]\n      output.send([0x80 + channel, note, 0], delay * 1000)\n    }\n  }\n\n  midi.stopAllNotes = function () {\n    output.cancel()\n    for (var channel = 0; channel < 16; channel++) {\n      output.send([0xB0 + channel, 0x7B, 0])\n    }\n  }\n\n  midi.connect = function (opts) {\n    root.setDefaultPlugin(midi)\n    var errFunction = function (err) { // well at least we tried!\n      if (window.AudioContext) { // Chrome\n        opts.api = 'webaudio'\n      } else if (window.Audio) { // Firefox\n        opts.api = 'audiotag'\n      } else { // no support\n        return err\n      }\n      root.loadPlugin(opts)\n    }\n    // /\n    navigator.requestMIDIAccess().then(function (access) {\n      plugin = access\n      var pluginOutputs = plugin.outputs\n      if (typeof pluginOutputs === 'function') { // Chrome pre-43\n        output = pluginOutputs()[0]\n      } else { // Chrome post-43\n        output = pluginOutputs[0]\n      }\n      if (output === undefined) { // nothing there...\n        errFunction()\n      } else {\n        opts.onsuccess && opts.onsuccess()\n      }\n    }, errFunction)\n  }\n})()\n","module.exports = {}\n","/*\n  ----------------------------------------------------------\n  midi.audioDetect : 0.3.2 : 2015-03-26\n  ----------------------------------------------------------\n  https://github.com/mudcube/midi.js\n  ----------------------------------------------------------\n  Probably, Maybe, No... Absolutely!\n  Test to see what types of <audio> MIME types are playable by the browser.\n  ----------------------------------------------------------\n*/\n\nconst supports = {} // object of supported file types\nlet pending = 0 // pending file types to process\nconst canPlayThrough = function (src) { // check whether format plays through\n  pending++\n  const body = document.body\n  const audio = new window.Audio()\n  const mime = src.split(';')[0]\n  audio.id = 'audio'\n  audio.setAttribute('preload', 'auto')\n  audio.setAttribute('audiobuffer', true)\n  audio.addEventListener('error', function () {\n    body.removeChild(audio)\n    supports[mime] = false\n    pending--\n  }, false)\n  audio.addEventListener('canplaythrough', function () {\n    body.removeChild(audio)\n    supports[mime] = true\n    pending--\n  }, false)\n  audio.src = 'data:' + src\n  body.appendChild(audio)\n}\n\nexport const audioDetect = function (onsuccess) {\n  // / detect jazz-midi plugin\n  if (navigator.requestMIDIAccess) {\n    const isNative = Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf('[native code]')\n    if (isNative) { // has native midiapi support\n      supports['webmidi'] = true\n    } else { // check for jazz plugin midiapi support\n      for (let n = 0; navigator.plugins.length > n; n++) {\n        const plugin = navigator.plugins[n]\n        if (plugin.name.indexOf('Jazz-Plugin') >= 0) {\n          supports['webmidi'] = true\n        }\n      }\n    }\n  }\n\n  // / check whether <audio> tag is supported\n  if (typeof (window.Audio) === 'undefined') {\n    return onsuccess({})\n  } else {\n    supports['audiotag'] = true\n  }\n\n  // / check for webaudio api support\n  if (window.AudioContext || window.webkitAudioContext) {\n    supports['webaudio'] = true\n  }\n\n  // / check whether canPlayType is supported\n  const audio = new window.Audio()\n  if (typeof (audio.canPlayType) === 'undefined') {\n    return onsuccess(supports)\n  }\n\n  // / see what we can learn from the browser\n  let vorbis = audio.canPlayType('audio/ogg; codecs=\"vorbis\"')\n  vorbis = (vorbis === 'probably' || vorbis === 'maybe')\n  let mpeg = audio.canPlayType('audio/mpeg')\n  mpeg = (mpeg === 'probably' || mpeg === 'maybe')\n  // maybe nothing is supported\n  if (!vorbis && !mpeg) {\n    onsuccess(supports)\n    return\n  }\n\n  // / or maybe something is supported\n  if (vorbis) canPlayThrough('audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA=')\n  if (mpeg) canPlayThrough('audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq')\n\n  // / lets find out!\n  const time = (new Date()).getTime()\n  let interval = window.setInterval(function () {\n    const now = (new Date()).getTime()\n    const maxExecution = now - time > 5000\n    if (!pending || maxExecution) {\n      window.clearInterval(interval)\n      onsuccess(supports)\n    }\n  }, 1)\n}\n","export * from './audio-detect'\nexport * from './load-script'\nexport * from './request'\n","/*\n  -----------------------------------------------------------\n  loadScript.js : 0.1.4 : 2014/02/12 : http://mudcu.be\n  -----------------------------------------------------------\n  Copyright 2011-2014 Mudcube. All rights reserved.\n  -----------------------------------------------------------\n  /// No verification\n  loadScript.add(\"../js/jszip/jszip.js\")\n  /// Strict loading order and verification.\n  loadScript.add({\n    strictOrder: true,\n    urls: [\n      {\n        url: \"../js/jszip/jszip.js\",\n        verify: \"JSZip\",\n        onsuccess: function() {\n          console.log(1)\n        }\n      },\n      {\n        url: \"../inc/downloadify/js/swfobject.js\",\n        verify: \"swfobject\",\n        onsuccess: function() {\n          console.log(2)\n        }\n      }\n    ],\n    onsuccess: function() {\n      console.log(3)\n    }\n  })\n  /// Just verification.\n  loadScript.add({\n    url: \"../js/jszip/jszip.js\",\n    verify: \"JSZip\",\n    onsuccess: function() {\n      console.log(1)\n    }\n  })\n*/\n\nconst _globalExists = function (path, root) {\n  try {\n    path = path.split('\"').join('').split(\"'\").join('').split(']').join('').split('[').join('.')\n    var parts = path.split('.')\n    var length = parts.length\n    var object = root || window\n    for (var n = 0; n < length; n++) {\n      var key = parts[n]\n      if (object[key] == null) {\n        return false\n      } else { //\n        object = object[key]\n      }\n    }\n    return true\n  } catch (e) {\n    return false\n  }\n}\n\nconst LoadScript = function () {\n  this.loaded = {}\n  this.loading = {}\n  return this\n}\n\nLoadScript.prototype.add = function (config) {\n  var that = this\n  if (typeof (config) === 'string') {\n    config = { url: config }\n  }\n  var urls = config.urls\n  if (typeof (urls) === 'undefined') {\n    urls = [{\n      url: config.url,\n      verify: config.verify\n    }]\n  }\n  // / adding the elements to the head\n  var doc = document.getElementsByTagName('head')[0]\n  // /\n  var testElement = function (element, test) {\n    if (that.loaded[element.url]) return\n    if (test && _globalExists(test) === false) return\n    that.loaded[element.url] = true\n    //\n    if (that.loading[element.url]) that.loading[element.url]()\n    delete that.loading[element.url]\n    //\n    if (element.onsuccess) element.onsuccess()\n    if (typeof (getNext) !== 'undefined') getNext()\n  }\n  // /\n  var hasError = false\n  var batchTest = []\n  var addElement = function (element) {\n    if (typeof (element) === 'string') {\n      element = {\n        url: element,\n        verify: config.verify\n      }\n    }\n    if (/([\\w\\d.\\[\\]'\"])$/.test(element.verify)) { // check whether its a variable reference\n      var verify = element.test = element.verify\n      if (typeof (verify) === 'object') {\n        for (var n = 0; n < verify.length; n++) {\n          batchTest.push(verify[n])\n        }\n      } else {\n        batchTest.push(verify)\n      }\n    }\n    if (that.loaded[element.url]) return\n    var script = document.createElement('script')\n    script.onreadystatechange = function () {\n      if (this.readyState !== 'loaded' && this.readyState !== 'complete') return\n      testElement(element)\n    }\n    script.onload = function () {\n      testElement(element)\n    }\n    script.onerror = function () {\n      hasError = true\n      delete that.loading[element.url]\n      if (typeof (element.test) === 'object') {\n        for (let key in element.test) {\n          removeTest(element.test[key])\n        }\n      } else {\n        removeTest(element.test)\n      }\n    }\n    script.setAttribute('type', 'text/javascript')\n    script.setAttribute('src', element.url)\n    doc.appendChild(script)\n    that.loading[element.url] = function () {}\n  }\n  // / checking to see whether everything loaded properly\n  var removeTest = function (test) {\n    var ret = []\n    for (var n = 0; n < batchTest.length; n++) {\n      if (batchTest[n] === test) continue\n      ret.push(batchTest[n])\n    }\n    batchTest = ret\n  }\n  var onLoad = function (element) {\n    if (element) {\n      testElement(element, element.test)\n    } else {\n      for (let n = 0; n < urls.length; n++) {\n        testElement(urls[n], urls[n].test)\n      }\n    }\n    var istrue = true\n    for (let n = 0; n < batchTest.length; n++) {\n      if (_globalExists(batchTest[n]) === false) {\n        istrue = false\n      }\n    }\n    if (!config.strictOrder && istrue) { // finished loading all the requested scripts\n      if (hasError) {\n        if (config.error) {\n          config.error()\n        }\n      } else if (config.onsuccess) {\n        config.onsuccess()\n      }\n    } else { // keep calling back the function\n      setTimeout(function () { // - should get slower over time?\n        onLoad(element)\n      }, 10)\n    }\n  }\n  // / loading methods;  strict ordering or loose ordering\n  if (config.strictOrder) {\n    var ID = -1\n    var getNext = function () {\n      ID++\n      if (!urls[ID]) { // all elements are loaded\n        if (hasError) {\n          if (config.error) {\n            config.error()\n          }\n        } else if (config.onsuccess) {\n          config.onsuccess()\n        }\n      } else { // loading new script\n        var element = urls[ID]\n        var url = element.url\n        if (that.loading[url]) { // already loading from another call (attach to event)\n          that.loading[url] = function () {\n            if (element.onsuccess) element.onsuccess()\n            getNext()\n          }\n        } else if (!that.loaded[url]) { // create script element\n          addElement(element)\n          onLoad(element)\n        } else { // it's already been successfully loaded\n          getNext()\n        }\n      }\n    }\n    getNext()\n  } else { // loose ordering\n    for (let ID = 0; ID < urls.length; ID++) {\n      addElement(urls[ID])\n      onLoad(urls[ID])\n    }\n  }\n}\n\nexport const loadScript = new LoadScript()\n","/*\n  ----------------------------------------------------------\n  Request : 0.1.1 : 2015-03-26\n  ----------------------------------------------------------\n  request({\n    url: './dir/something.extension',\n    data: 'test!',\n    format: 'text', // text | xml | json | binary\n    responseType: 'text', // arraybuffer | blob | document | json | text\n    headers: {},\n    withCredentials: true, // true | false\n    ///\n    onerror: function(evt, percent) {\n      console.log(evt)\n    },\n    onsuccess: function(evt, responseText) {\n      console.log(responseText)\n    },\n    onprogress: function(evt, percent) {\n      percent = Math.round(percent * 100)\n      loader.create('thread', 'loading... ', percent)\n    }\n  })\n*/\n\nexport function request (opts, onsuccess, onerror, onprogress) {\n  if (typeof opts === 'string') opts = {url: opts}\n  const data = opts.data\n  const url = opts.url\n  const method = opts.method || (opts.data ? 'POST' : 'GET')\n  const format = opts.format\n  const headers = opts.headers\n  const responseType = opts.responseType\n  const withCredentials = opts.withCredentials || false\n  const xhr = new window.XMLHttpRequest()\n  onsuccess = onsuccess || opts.onsuccess\n  onerror = onerror || opts.onerror\n  onprogress = onprogress || opts.onprogress\n  xhr.open(method, url, true)\n  if (headers) {\n    for (var type in headers) {\n      xhr.setRequestHeader(type, headers[type])\n    }\n  } else if (data) { // set the default headers for POST\n    xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded')\n  }\n  if (format === 'binary') { // - default to responseType=\"blob\" when supported\n    if (xhr.overrideMimeType) {\n      xhr.overrideMimeType('text/plain; charset=x-user-defined')\n    }\n  }\n  if (responseType) {\n    xhr.responseType = responseType\n  }\n  if (withCredentials) {\n    xhr.withCredentials = 'true'\n  }\n  if (onerror && 'onerror' in xhr) {\n    xhr.onerror = onerror\n  }\n  if (onprogress && xhr.upload && 'onprogress' in xhr.upload) {\n    if (data) {\n      xhr.upload.onprogress = function (evt) {\n        onprogress.call(xhr, evt, evt.loaded / evt.total)\n      }\n    } else {\n      xhr.addEventListener('progress', function (evt) {\n        var totalBytes = 0\n        if (evt.lengthComputable) {\n          totalBytes = evt.total\n        } else if (xhr.totalBytes) {\n          totalBytes = xhr.totalBytes\n        } else {\n          var rawBytes = parseInt(xhr.getResponseHeader('Content-Length-Raw'))\n          if (isFinite(rawBytes)) {\n            xhr.totalBytes = totalBytes = rawBytes\n          } else {\n            return\n          }\n        }\n        onprogress.call(xhr, evt, evt.loaded / totalBytes)\n      })\n    }\n  }\n  // /\n  xhr.onreadystatechange = function (evt) {\n    if (xhr.readyState === 4) { // The request is complete\n      if (xhr.status === 200 || // Response OK\n        xhr.status === 304 || // Not Modified\n        xhr.status === 308 // Permanent Redirect\n      ) {\n        if (onsuccess) {\n          var res\n          if (format === 'xml') {\n            res = evt.target.responseXML\n          } else if (format === 'text') {\n            res = evt.target.responseText\n          } else if (format === 'json') {\n            try {\n              res = JSON.parse(evt.target.response)\n            } catch (err) {\n              onerror && onerror.call(xhr, evt)\n            }\n          }\n          onsuccess.call(xhr, evt, res)\n        }\n      } else {\n        onerror && onerror.call(xhr, evt)\n      }\n    }\n  }\n  xhr.send(data)\n  return xhr\n}\n"],"sourceRoot":""}